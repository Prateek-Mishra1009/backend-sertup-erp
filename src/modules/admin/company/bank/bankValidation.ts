import { Request, Response, NextFunction } from "express";
import validator from "../../../../helpers/validator";
import constants from "../../../../utils/constants";
import { getMessage, validateRequestData } from "../../../../helpers/helper";

const addBank = async(req:any, res:Response, next:NextFunction)=>{
  try {
    const validationRule = {
      company_id: "required",
      bank_name: "required|string",
      branchName: "required|string",
      ifsc: "required|checkIFSCCode",
      accountName: "required",
      accountType: "required",
      "account_no.value": "required|checkAccountNumber" 
     
    };
    const msg = {};

    await validator(
      req.body,
      validationRule,
      msg,
      async (err: any, status: boolean) => {
        if (!status) {
          res.status(constants.code.preconditionFailed).json({
            status: constants.status.statusFalse,
            userStatus: req.status,
            message: await getMessage(err),
          });
        } else {
          next();
        }
      }
    );
  } catch (err) {
    res.status(constants.code.preconditionFailed).json({
      status: constants.status.statusFalse,
      userStatus: req.status,
      message: err,
    });
  }
}


const updateBank = async(req:any, res:Response, next:NextFunction)=>{
  try {
    const validationRule = {
      company_id: "required",
      bank_name: "required|string",
      branchName: "required|string",
      ifsc: "required|checkIFSCCode",
      accountName: "required",
      accountType: "required",
      "account_no.value": "required" 
     
    };
    const msg = {};

    await validator(
      req.body,
      validationRule,
      msg,
      async (err: any, status: boolean) => {
        if (!status) {
          res.status(constants.code.preconditionFailed).json({
            status: constants.status.statusFalse,
            userStatus: req.status,
            message: await getMessage(err),
          });
        } else {
          next();
        }
      }
    );
  } catch (err) {
    res.status(constants.code.preconditionFailed).json({
      status: constants.status.statusFalse,
      userStatus: req.status,
      message: err,
    });
  }
}


const listBank = async(req:any, res:Response, next:NextFunction)=>{
  try {
    const validationRule = {
      page: "required|string",
      limit: "required|string",
      sort: "required|string|in:asc,desc",
      search: "string",
    };
    const msg = {};

    await validator(
      req.query,
      validationRule,
      msg,
      async (err: any, status: boolean) => {
        if (!status) {
          res.status(constants.code.preconditionFailed).json({
            status: constants.status.statusFalse,
            userStatus: req.status,
            message: await getMessage(err),
          });
        } else if (
          (await validateRequestData(validationRule, req.query)) !== true
        ) {
          res.status(constants.code.expectationFailed).json({
            status: constants.status.statusFalse,
            userStatus: req.status,
            message: constants.message.unwantedData,
          });
        } else {
          next();
        }
      }
    );
  } catch (err) {
    res.status(constants.code.preconditionFailed).json({
      status: constants.status.statusFalse,
      userStatus: req.status,
      message: err,
    });
  }
}


const bankDetail = async(req:any, res:Response, next:NextFunction)=>{
  try {
    const validationRule = {
      bank_id: "required|string|min:24",
    };
    const msg = {};

    await validator(
      req.params,
      validationRule,
      msg,
      async (err: any, status: boolean) => {
        if (!status) {
          res.status(constants.code.preconditionFailed).json({
            status: constants.status.statusFalse,
            userStatus: req.status,
            message: await getMessage(err),
          });
        } else {
          next();
        }
      }
    );
  } catch (err) {
    res.status(constants.code.preconditionFailed).json({
      status: constants.status.statusFalse,
      userStatus: req.status,
      message: err,
    });
  }
}



const deleteBank = async(req:any, res:Response, next:NextFunction)=>{
  try {
    const validationRule = {
      is_delete: "required|boolean|in:true,false",
    };
    const msg = {};
    await validator(
      req.body,
      validationRule,
      msg,
      async (err: any, status: boolean) => {
        if (!status) {
          res.status(constants.code.preconditionFailed).json({
            status: constants.status.statusFalse,
            userStatus: req.status,
            message: await getMessage(err),
          });
        } else {
          next();
        }
      }
    );
  } catch (err) {
    res.status(constants.code.preconditionFailed).json({
      status: constants.status.statusFalse,
      userStatus: req.status,
      message: err,
    });
  }
}


  export default {
    addBank,
    updateBank,
    listBank,
    bankDetail,
    deleteBank
  }